<div class="form-container">
  <!-- Header -->
  <div class="form-header mb-4">
    <div>
      <h2 class="mb-1">
        <i class="bi bi-plus-circle me-2"></i>
        Editar Producto
      </h2>
      <p class="text-muted mb-0">Modifica la información del producto</p>
    </div>
  </div>

  <!-- Form Card -->
  <div class="form-card">
    <form [formGroup]="stockForm" (ngSubmit)="onSubmit()">
      <div class="row g-4">
        
        <!-- Información Básica -->
        <div class="col-12">
          <div class="section-title">
            <i class="bi bi-info-circle me-2"></i>
            Información Básica
          </div>
        </div>

        <!-- Nombre del Producto -->
        <div class="col-md-6">
          <label for="nombre" class="form-label">
            Nombre del Producto <span class="text-danger">*</span>
          </label>
          <div class="input-with-icon">
            <i class="bi bi-box-seam input-icon"></i>
            <input 
              type="text" 
              class="form-control form-control-custom" 
              [class.is-invalid]="hasError('nombre')"
              id="nombre"
              formControlName="nombre"
              placeholder="Ej: Cerveza Paceña">
          </div>
          @if (hasError('nombre')) {
            <div class="invalid-feedback d-block">
              {{ getErrorMessage('nombre') }}
            </div>
          }
        </div>

        <!-- Marca -->
        <div class="col-md-6">
          <label for="marca" class="form-label">
            Marca <span class="text-danger">*</span>
          </label>
          <div class="input-with-icon">
            <i class="bi bi-tag input-icon"></i>
            <input 
              type="text" 
              class="form-control form-control-custom"
              [class.is-invalid]="hasError('marca')"
              id="marca"
              formControlName="marca"
              placeholder="Ej: CBN">
          </div>
          @if (hasError('marca')) {
            <div class="invalid-feedback d-block">
              {{ getErrorMessage('marca') }}
            </div>
          }
        </div>

        <!-- Categoría -->
        <div class="col-md-6">
          <label for="categoria" class="form-label">
            Categoría <span class="text-danger">*</span>
          </label>
          <div class="input-with-icon">
            <i class="bi bi-grid input-icon"></i>
            <select 
              class="form-select form-control-custom"
              [class.is-invalid]="hasError('categoria')"
              id="categoria"
              formControlName="categoria">
              <option value="">Selecciona una categoría</option>
              <option value="Cervezas">Cervezas</option>
              <option value="Licores">Licores</option>
              <option value="Cigarrillos">Cigarrillos</option>
              <option value="Productos Tradicionales">Productos Tradicionales</option>
              <option value="Bebidas">Bebidas</option>
              <option value="Vinos">Vinos</option>
              <option value="Snacks">Snacks</option>
            </select>
          </div>
          @if (hasError('categoria')) {
            <div class="invalid-feedback d-block">
              {{ getErrorMessage('categoria') }}
            </div>
          }
        </div>

        <!-- Presentación -->
        <div class="col-md-6">
          <label for="presentacion" class="form-label">
            Presentación <span class="text-danger">*</span>
          </label>
          <div class="input-with-icon">
            <i class="bi bi-cup input-icon"></i>
            <input 
              type="text" 
              class="form-control form-control-custom"
              [class.is-invalid]="hasError('presentacion')"
              id="presentacion"
              formControlName="presentacion"
              placeholder="Ej: Botella 620ml">
          </div>
          @if (hasError('presentacion')) {
            <div class="invalid-feedback d-block">
              {{ getErrorMessage('presentacion') }}
            </div>
          }
        </div>

        <!-- Descripción -->
        <div class="col-12">
          <label for="descripcion" class="form-label">
            Descripción
          </label>
          <textarea 
            class="form-control form-control-custom" 
            id="descripcion"
            formControlName="descripcion"
            rows="3"
            placeholder="Describe el producto..."></textarea>
        </div>

        <!-- Precios y Stock -->
        <div class="col-12 mt-4">
          <div class="section-title">
            <i class="bi bi-cash-stack me-2"></i>
            Precios y Stock
          </div>
        </div>

        <!-- Precio -->
        <div class="col-md-4">
          <label for="precio" class="form-label">
            Precio (Bs.) <span class="text-danger">*</span>
          </label>
          <div class="input-with-icon">
            <i class="bi bi-currency-dollar input-icon"></i>
            <input 
              type="number" 
              class="form-control form-control-custom"
              [class.is-invalid]="hasError('precio')"
              id="precio"
              formControlName="precio"
              placeholder="0.00"
              step="0.01"
              min="0">
          </div>
          @if (hasError('precio')) {
            <div class="invalid-feedback d-block">
              {{ getErrorMessage('precio') }}
            </div>
          }
        </div>

        <!-- Descuento -->
        <div class="col-md-4">
          <label for="descuento" class="form-label">
            Descuento (%)
          </label>
          <div class="input-with-icon">
            <i class="bi bi-percent input-icon"></i>
            <input 
              type="number" 
              class="form-control form-control-custom"
              [class.is-invalid]="hasError('descuento')"
              id="descuento"
              formControlName="descuento"
              placeholder="0"
              min="0"
              max="100">
          </div>
          <small class="form-text text-muted">Opcional: 0-100%</small>
          @if (hasError('descuento')) {
            <div class="invalid-feedback d-block">
              {{ getErrorMessage('descuento') }}
            </div>
          }
        </div>

        <!-- Stock Actual -->
        <div class="col-md-4">
          <label for="stock" class="form-label">
            Stock Actual <span class="text-danger">*</span>
          </label>
          <div class="input-with-icon">
            <i class="bi bi-box input-icon"></i>
            <input 
              type="number" 
              class="form-control form-control-custom"
              [class.is-invalid]="hasError('stock')"
              id="stock"
              formControlName="stock"
              placeholder="0"
              min="0">
          </div>
          @if (hasError('stock')) {
            <div class="invalid-feedback d-block">
              {{ getErrorMessage('stock') }}
            </div>
          }
        </div>

        <!-- Stock Mínimo -->
        <div class="col-md-6">
          <label for="stockMinimo" class="form-label">
            Stock Mínimo <span class="text-danger">*</span>
          </label>
          <div class="input-with-icon">
            <i class="bi bi-exclamation-triangle input-icon"></i>
            <input 
              type="number" 
              class="form-control form-control-custom"
              [class.is-invalid]="hasError('stockMinimo')"
              id="stockMinimo"
              formControlName="stockMinimo"
              placeholder="0"
              min="0">
          </div>
          <small class="form-text text-muted">Alerta cuando el stock llegue a este número</small>
          @if (hasError('stockMinimo')) {
            <div class="invalid-feedback d-block">
              {{ getErrorMessage('stockMinimo') }}
            </div>
          }
        </div>

        <!-- Imagen -->
        <div class="col-md-6">
          <label for="imagen" class="form-label">
            URL de Imagen
          </label>
          <div class="input-with-icon">
            <i class="bi bi-image input-icon"></i>
            <input 
              type="url" 
              class="form-control form-control-custom"
              [class.is-invalid]="hasError('imagen')"
              id="imagen"
              formControlName="imagen"
              placeholder="https://ejemplo.com/imagen.jpg">
          </div>
          <small class="form-text text-muted">URL de la imagen del producto</small>
          @if (hasError('imagen')) {
            <div class="invalid-feedback d-block">
              {{ getErrorMessage('imagen') }}
            </div>
          }
        </div>

        <!-- Preview de Imagen -->
        <div class="col-12">
          <div class="image-preview-container">
            <label class="form-label">Vista Previa</label>
            <div class="image-preview">
              <img 
                [src]="imagePreview()" 
                alt="Preview"
                class="preview-img"
                (error)="imagePreview.set('https://via.placeholder.com/300x300?text=Error+al+cargar')">
              <p class="text-muted mb-0 mt-2">
                <small>La imagen se mostrará aquí</small>
              </p>
            </div>
          </div>
        </div>

        <!-- Botones de Acción -->
        <div class="col-12 mt-4">
          <hr class="mb-4">
          <div class="d-flex gap-3 justify-content-end">
            <button type="button" class="btn btn-secondary" (click)="onCancel()">
              <i class="bi bi-x-circle me-2"></i>
              Cancelar
            </button>
            <button type="button" class="btn btn-outline-primary" (click)="onPreview()">
              <i class="bi bi-eye me-2"></i>
              Vista Previa
            </button>
             <button type="submit" class="btn btn-primary" [disabled]="isLoading()">
                @if (isLoading()) {
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                Actualizando...
                } @else {
                <i class="bi bi-save me-2"></i>
                Actualizar Producto  <!-- ⬅️ CAMBIADO -->
                }
            </button>
          </div>
        </div>

      </div>
    </form>
  </div>

  <!-- Info Card -->
  <div class="info-card mt-4">
    <div class="info-icon">
      <i class="bi bi-lightbulb"></i>
    </div>
    <div class="info-content">
      <h6 class="mb-2">Consejos para agregar productos</h6>
      <ul class="mb-0">
        <li>Usa nombres descriptivos y claros</li>
        <li>Establece un stock mínimo adecuado para evitar desabastecimiento</li>
        <li>Verifica que la URL de la imagen sea válida</li>
        <li>Los campos marcados con <span class="text-danger">*</span> son obligatorios</li>
      </ul>
    </div>
  </div>
</div>